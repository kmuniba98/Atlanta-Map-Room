<!DOCTYPE html>
<html>

<head>
  <meta charset=utf-8 />
  <title>Table</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
  <script src='https://api.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.js'></script>
  <script src="/socket.io/socket.io.js"></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.css' rel='stylesheet' />

</head>

<body>


    <table id="table" class="display" style="width:100%">
        <thead>
            <tr>
                <th>ID</th>
                <th>Latitude</th>
                <th>Longitude</th>
                <th>ParcelID</th>
                <th>AssessChange</th>
                <th>ApprChange</th>
                <th>OBJECTID</th>
                <th>TaxYear</th>
                <th>Address</th>
                <th>AddrNumber</th>
                <th>AddrPreDir</th>
                <th>AddrStreet</th>
                <th>AddrSuffix</th>
                <th>AddrPosDir</th>
                <th>AddrUntTyp</th>
                <th>AddrUnit</th>
                <th>Owner</th>
                <th>OwnerAddr1</th>
                <th>OwnerAddr2</th>
                <th>TaxDist</th>
                <th>TotAssess</th>
                <th>LandAssess</th>
                <th>ImprAssess</th>
                <th>TotAppr</th>
                <th>LandAppr</th>
                <th>ImprAppr</th>
                <th>LUCode</th>
                <th>ClassCode</th>
                <th>ExCode</th>
                <th>LivUnits</th>
                <th>LandAcres</th>
                <th>NbrHood</th>
                <th>Subdiv</th>
                <th>SubdivNum</th>
                <th>SubdivLot</th>
                <th>SubdivBlck</th>
                <th>FeatureID</th>
                <th>SHAPESTArea</th>
                <th>SHAPESTLength</th>
                <th>OBJECTID</th>
                <th>DIGEST</th>
                <th>SITUS</th>
                <th>TAXPIN</th>
                <th>ATRPIN</th>
                <th>TAX_DISTR</th>
                <th>OWNER1</th>
                <th>OWNER2</th>
                <th>ADD2</th>
                <th>ADD3</th>
                <th>ADD4</th>
                <th>ADD5</th>
                <th>LUC</th>
                <th>NBHD</th>
                <th>PROP_CLASS</th>
                <th>CLASS</th>
                <th>TOT_APPR</th>
                <th>TOT_ASSESS</th>
                <th>IMPR_APPR</th>
                <th>LAND_APPR</th>
                <th>FUL_EX_COD</th>
                <th>VAL_ACRES</th>
                <th>STRUCT_FLR</th>
                <th>STRUCT_YR</th>
                <th>TIEBACK</th>
                <th>TAXYEAR</th>
                <th>STATUS_COD</th>
                <th>LIV_UNITS</th>
                <th>PCODE</th>
                <th>UNIT_NUM</th>
                <th>GID</th>
                <th>EXTVER</th>
                <th>ShapeSTArea</th>
                <th>ShapeSTLength</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </tbody>
    </table>

  <script>

  var socket = io('http://128.61.121.12:8080/');


  socket.on('updateTable', function(data) {
    console.log("updating table");
    console.log(data);
    $("table").DataTable().destroy();
    var datatable = $("table").DataTable({
        //removed data.features, use in 
        "aaData":data,
        "aoColums":[
            {title: "ID"},
            {title: "ParcelID"},
            {title: "Address"},
            {title: "Assessment % Change"},
            {title: "Appraisal % Change"},
            {title: "OBJECTID"},
            {title: "TaxYear"},
            {title: "Address"},
            {title: "AddrNumber"},
            {title: "AddrPreDir"},
            {title: "AddrStreet"},
            {title: "AddrSuffix"},
            {title: "AddrPosDir"},
            {title: "AddrUntTyp"},
            {title: "AddrUnit"},
            {title: "Owner"},
            {title: "OwnerAddr1"},
            {title: "OwnerAddr2"},
            {title: "TaxDist"},
            {title: "TotAssess"},
            {title: "LandAssess"},
            {title: "ImprAssess"},
            {title: "TotAppr"},
            {title: "LandAppr"},
            {title: "ImprAppr"},
            {title: "LUCode"},
            {title: "ClassCode"},
            {title: "ExCode"},
            {title: "LivUnits"},
            {title: "LandAcres"},
            {title: "NbrHood"},
            {title: "Subdiv"},
            {title: "SubdivNum"},
            {title: "SubdivLot"},
            {title: "SubdivBlck"},
            {title: "FeatureID"},
            {title: "SHAPESTArea"},
            {title: "SHAPESTLength"},
            {title: "OBJECTID"},
            {title: "DIGEST"},
            {title: "SITUS"},
            {title: "TAXPIN"},
            {title: "ATRPIN"},
            {title: "TAX_DISTR"},
            {title: "OWNER1"},
            {title: "OWNER2"},
            {title: "ADD2"},
            {title: "ADD3"},
            {title: "ADD4"},
            {title: "ADD5"},
            {title: "LUC"},
            {title: "NBHD"},
            {title: "PROP_CLASS"},
            {title: "CLASS"},
            {title: "TOT_APPR"},
            {title: "TOT_ASSESS"},
            {title: "IMPR_APPR"},
            {title: "LAND_APPR"},
            {title: "FUL_EX_COD"},
            {title: "VAL_ACRES"},
            {title: "STRUCT_FLR"},
            {title: "STRUCT_YR"},
            {title: "TIEBACK"},
            {title: "TAXYEAR"},
            {title: "STATUS_COD"},
            {title: "LIV_UNITS"},
            {title: "PCODE"},
            {title: "UNIT_NUM"},
            {title: "GID"},
            {title: "EXTVER"},
            {title: "ShapeSTArea"},
            {title: "ShapeSTLength"}
        ],
        "info":false,
        "lengthChange": false,
        "paging": false,
        "order":[],
    });
  });


  $(document).ready( function () {
    $('table').DataTable({
        "info":false,
        "lengthChange": false,
        "paging": false,
        "display": true,
  });

  var currClick = -1;
    $('table tbody').on( 'click', 'tr', function () {
      var tab = $('table').DataTable();
      if ($(this).hasClass('selected')){
        $(this).removeClass('selected');
          socket.emit("removeMarker", {'removeMarker':tab.row(this).data()[0]});
          console.log(tab.row(this).data()[0]);
        currClick = -1;
        console.log("resetting currClick");
      }
      else{
          if (currClick > -1){
              console.log(currClick);
              socket.emit("removeMarker", {'removeMarker':tab.row(currClick).data()[0]});
              console.log(tab.row(currClick).data()[0]);
          };
          //need to remove from selected class
          tab.$('tr.selected').removeClass('selected');
          currClick = tab.row(this).index();
          console.log(currClick);
          $(this).addClass('selected');
          socket.emit("newMarker", {'newMarker':tab.row(this).data(), 'index':tab.row(this).index()});
          console.log(tab.row(currClick).data()[0]);
      }
  });
  });
    </script>

</body>


</html>
